version: 0.2

env:
  variables:
    PORT: "7500"
    PORT_FRONTEND: "3000"
    POSTGRES_HOST: "localhost"
    POSTGRES_USER: "postgres"
    POSTGRES_DB: "music-app"
    POSTGRESS_PASSWORD: "PDROf6{EcmxBT"
    POSTGRESS_PORT: "5432"
    PRIVATE_KEY: "secret_key_music_app"

phases:
  install:
    runtime-versions:
      nodejs: 18
    commands:
      - cd client
      - npm install
      - npm run build

  post_build:
    commands:
      - cd ../server
      - npm install
      - npm run build

cache:
  paths:
    - '/root/.npm' # Кэширование папки npm для ускорения установки зависимостей

artifacts:
  files:
    - '*/' # Включить все файлы из папок frontend и backend
  base-directory:
    - client/build # Укажите папку с собранным фронтендом
    - server/build # Укажите папку с собранным бэкендом